@model CarDetailViewModel
<div class="page-heading header-text" style="background-image: url(@("/images/" + Model.Car.Image.FileName))">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
              
            <h1>@Model.Car.Brand.Name</h1>
            <span>@Model.Car.Model</span>
          </div>
        </div>
      </div>
    </div>
    
<div class="more-info about-info">
    <div class="container">
        <div class="more-info-content">
            <div class="right-content">
                  @if (TempData["RentError"] != null)
                {
                    var message = (TempData["RentError"] as String);

                    <div class="row p-3 mb-2 bg-warning text-dark">
                        <div class="col-md-12">
                            <div>
                                @message
                            </div>
                        </div>
                    </div>
                }
                @if (TempData["CommentSuccess"] != null)
                {
                    var message = (TempData["CommentSuccess"] as String);

                    <div class="row p-3 mb-2 bg-success text-dark">
                        <div class="col-md-12">
                            <div>
                                @message
                            </div>
                        </div>
                    </div>
                }
                <div class="row g-4 py-5 row-cols-1 row-cols-lg-3">
                    <div class="feature col">
                        <div class="feature-icon d-inline-flex align-items-center justify-content-center text-bg-primary bg-gradient fs-2 mb-3">
                            
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-fuel-pump" viewBox="0 0 16 16">
                                <path d="M3 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1-.5-.5v-5Z" />
                                <path d="M1 2a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v8a2 2 0 0 1 2 2v.5a.5.5 0 0 0 1 0V8h-.5a.5.5 0 0 1-.5-.5V4.375a.5.5 0 0 1 .5-.5h1.495c-.011-.476-.053-.894-.201-1.222a.97.97 0 0 0-.394-.458c-.184-.11-.464-.195-.9-.195a.5.5 0 0 1 0-1c.564 0 1.034.11 1.412.336.383.228.634.551.794.907.295.655.294 1.465.294 2.081v3.175a.5.5 0 0 1-.5.501H15v4.5a1.5 1.5 0 0 1-3 0V12a1 1 0 0 0-1-1v4h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1V2Zm9 0a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v13h8V2Z" />
                            </svg>

                        </div>
                        <h3 class="fs-2">@Model.Car.FuelType</h3>
                        <p>Araca ait yakıt türü bilgisini içerir</p>                        
                    </div>
                    <div class="feature col">
                        <div class="feature-icon d-inline-flex align-items-center justify-content-center text-bg-primary bg-gradient fs-2 mb-3">
                            
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-car-front" viewBox="0 0 16 16">
                              <path d="M4 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm10 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM6 8a1 1 0 0 0 0 2h4a1 1 0 1 0 0-2H6ZM4.862 4.276 3.906 6.19a.51.51 0 0 0 .497.731c.91-.073 2.35-.17 3.597-.17 1.247 0 2.688.097 3.597.17a.51.51 0 0 0 .497-.731l-.956-1.913A.5.5 0 0 0 10.691 4H5.309a.5.5 0 0 0-.447.276Z"/>
                              <path d="M2.52 3.515A2.5 2.5 0 0 1 4.82 2h6.362c1 0 1.904.596 2.298 1.515l.792 1.848c.075.175.21.319.38.404.5.25.855.715.965 1.262l.335 1.679c.033.161.049.325.049.49v.413c0 .814-.39 1.543-1 1.997V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.338c-1.292.048-2.745.088-4 .088s-2.708-.04-4-.088V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.892c-.61-.454-1-1.183-1-1.997v-.413a2.5 2.5 0 0 1 .049-.49l.335-1.68c.11-.546.465-1.012.964-1.261a.807.807 0 0 0 .381-.404l.792-1.848ZM4.82 3a1.5 1.5 0 0 0-1.379.91l-.792 1.847a1.8 1.8 0 0 1-.853.904.807.807 0 0 0-.43.564L1.03 8.904a1.5 1.5 0 0 0-.03.294v.413c0 .796.62 1.448 1.408 1.484 1.555.07 3.786.155 5.592.155 1.806 0 4.037-.084 5.592-.155A1.479 1.479 0 0 0 15 9.611v-.413c0-.099-.01-.197-.03-.294l-.335-1.68a.807.807 0 0 0-.43-.563 1.807 1.807 0 0 1-.853-.904l-.792-1.848A1.5 1.5 0 0 0 11.18 3H4.82Z"/>
                            </svg>

                        </div>
                        <h3 class="fs-2">@Model.Car.Category.CategoryName</h3>
                        <p>Araca ait kategori bilgisi içerir</p>                        
                    </div>
                    <div class="feature col">
                        <div class="feature-icon d-inline-flex align-items-center justify-content-center text-bg-primary bg-gradient fs-2 mb-3">
                            
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-speedometer" viewBox="0 0 16 16">
                                <path d="M8 2a.5.5 0 0 1 .5.5V4a.5.5 0 0 1-1 0V2.5A.5.5 0 0 1 8 2zM3.732 3.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707zM2 8a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 8zm9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5zm.754-4.246a.389.389 0 0 0-.527-.02L7.547 7.31A.91.91 0 1 0 8.85 8.569l3.434-4.297a.389.389 0 0 0-.029-.518z" />
                                <path fill-rule="evenodd" d="M6.664 15.889A8 8 0 1 1 9.336.11a8 8 0 0 1-2.672 15.78zm-4.665-4.283A11.945 11.945 0 0 1 8 10c2.186 0 4.236.585 6.001 1.606a7 7 0 1 0-12.002 0z" />
                            </svg>

                        </div>
                        <h3 class="fs-2">@Model.Car.Kilometer km</h3>
                        <p>Araca ait kilometre bilgisini içerir</p>
                                                
                    </div>
                    <div class="feature col">
                        <div class="feature-icon d-inline-flex align-items-center justify-content-center text-bg-primary bg-gradient fs-2 mb-3">
                            
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-stopwatch-fill" viewBox="0 0 16 16">
                                <path d="M6.5 0a.5.5 0 0 0 0 1H7v1.07A7.001 7.001 0 0 0 8 16a7 7 0 0 0 5.29-11.584.531.531 0 0 0 .013-.012l.354-.354.353.354a.5.5 0 1 0 .707-.707l-1.414-1.415a.5.5 0 1 0-.707.707l.354.354-.354.354a.717.717 0 0 0-.012.012A6.973 6.973 0 0 0 9 2.071V1h.5a.5.5 0 0 0 0-1h-3zm2 5.6V9a.5.5 0 0 1-.5.5H4.5a.5.5 0 0 1 0-1h3V5.6a.5.5 0 1 1 1 0z" />
                            </svg>

                        </div>
                        <h3 class="fs-2">@Model.Car.Model</h3>
                        <p>Araca ait model yılı bilgisini içerir</p>
                                                
                    </div>
                </div>
               
     </div>
         <p>@Html.Raw(Model.Car.Description)</p>   
    </div>
        
        <div class="mt-5 col-md-12">
            <form asp-controller="Payment" id="RentForm" asp-action="Index" method="post" name="PaymentAndRent" onsubmit="return validateForm()">
              
             <input type="hidden" name="BrandName" value="@Model.Car.Brand.Name" />
             <input type="hidden" name="Model" value="@Model.Car.Model" />
                <input type="hidden" name="Id" value="@Model.Car.Id" />
             
             
        <div class="d-flex">
        <div class="col-md-6">
            <div class="form-group">
                <label class="control-label" for="RentACar">Kiralama Başlangıç Tarihi:</label>
                <input id="RentACar" class="form-control" type="datetime-local" name="RentACar" value="" />
            </div>
            <div class="form-group">
                <label class="control-label" for="RentACar">Araç Teslim Tarihi:</label>
                <input id="EndTime" class="form-control" type="datetime-local" name="EndTime" value="" />
            </div>
            <div class="form-group">
                <label class="control-label" for="result">Kiralama Süresi:</label>
                <input id="result" class="form-control" type="text" name="result" value="" readonly />
            </div>
            <div class="form-group">
                <label class="control-label" for="TotalPrice">Toplam Fiyat:</label>
                <div class="d-flex">
                <input id="TotalPrice" class="form-control" type="text" name="TotalPrice" value="@Model.Car.Price" readonly />
                <span class="mt-2 ml-2">TL</span>
                </div>
            </div>
            <div class="form-group">
               
            </div>
        </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label class="control-label" for="result">Kart Numarası:</label>
                    <input id="cardNumber" name="CardNumber" type="text" class="form-control"  value="" placeholder="XXXX-XXXX-XXXX-XXXX" />
                    
                </div>
                <div class="form-group d-flex mb-0">
                   <div class="form-group col-md-3"> 
                        <label class="control-label">AY</label>
                        <input class="form-control" id="expireMonth" name="ExpireMonth" type="text" placeholder="MM" />
                       
                   </div>
                    <div class="form-group col-md-3">
                        <label class="control-label">YIL</label>
                                <input class="form-control" id="expireYear" name="ExpireYear" type="text" placeholder="YY" />

                    </div>
                   <div class="form-group col-md-6">
                        <label class="control-label">CVV Kod</label>
                                <input class="form-control" id="cvv" name="Cvc" type="text" placeholder="CVV" />
                       
                   </div>
                </div>
                
                <div class="form-group">
                            <label class="control-label">Kart Sahibi</label>
                            <input class="form-control" type="text" id="cardHolderName" name="CardHolderName" placeholder="Kart Sahibinin Adı Soyadı" />
                </div>
                <div class="form-group">
                    
                </div>
                <div class="form-group mt-5">
                    @if(User.Identity.IsAuthenticated){
                    <button type="submit" class="btn btn-success float-right">Öde ve Kirala</button>
                            }
                            else{
                                <span class="alert-warning mt-4 float-left">İşlemlere devam etmek için giriş yapmalısınız.</span>
                                <a asp-action="Login" asp-controller="User" class="btn btn-success mt-3 float-right">Giriş Yap</a>
                            }
                </div>
            </div>

        </div>

        </form>
        </div>
</div>
     
</div>

@await Html.PartialAsync("../PartialViews/_PartialComment",Model.Comments)


@await Html.PartialAsync("../PartialViews/_PartialLeaveComment", new CommentAddDto())


<script>
    $(document).ready(function () {
        $("#cardNumber").inputmask("9999-9999-9999-9999");
    });
    $(document).ready(function(){
        $("#expireMonth").inputmask("99");
    });
    $(document).ready(function () {
        $("#expireYear").inputmask("99");
    });
    $(document).ready(function () {
        $("#cvv").inputmask("999");
    });

    function validateForm() {
        var cardNumber = document.forms["PaymentAndRent"]["cardNumber"].value;
        var expireMonth = document.forms["PaymentAndRent"]["expireMonth"].value;
        var expireYear = document.forms["PaymentAndRent"]["expireYear"].value;
        var cardHolderName = document.forms["PaymentAndRent"]["cardHolderName"].value;
        var cvv=document.forms["PaymentAndRent"]["cvv"].value;
        var result=document.forms["PaymentAndRent"]["result"].value;

        if (cardNumber == "") {
            alert("Kart numarası boş olamaz");
            return false;
        } else if (!/^\d{4}-\d{4}-\d{4}-\d{4}$/.test(cardNumber)) {
            alert("Kart numarası formatı yanlış");
            return false;
        }

        if (expireMonth == "") {
            alert("Ödeme formunda boş alan geçilemez");
            return false;
        } else if (!/^\d{2}$/.test(expireMonth)) {
            alert("Geçerli bir MM alanı girin");
            return false;
        }

        if (expireYear == "") {
            alert("Ödeme formunda boş alan geçilemez");
            return false;
        } else if (!/^\d{2}$/.test(expireYear)) {
            alert("Geçerli bir YY Alanı girin");
            return false;
        }

        if (cardHolderName == "") {
            alert("Kart sahibi bilgileri boş geçilemez");
            return false;
        }
        if (cvv == "") {
            alert("Ödeme formunda boş alan geçilemez");
            return false;
        } else if (!/^\d{3}$/.test(cvv)) {
            alert("Geçerli bir CVV alanı girin");
            return false;
        }

        if (result== ""){
            alert("Kiralama süresi boş olamaz lütfen kira başlangıç tarihi ve araç teslim tarihi kontrol edin.")
            return false;
        }

        return true;
    }
    
</script>
<script>

    const currentDate = new Date();
    const twoHoursLater = new Date(currentDate.getTime() +( 5 * 60 * 60 * 1000));

    document.getElementById("RentACar").value = twoHoursLater.toISOString().substring(0, 16);

    const RentACarInput = document.getElementById("RentACar");
    const EndTimeInput = document.getElementById("EndTime");

    RentACarInput.addEventListener("change", function () {
        const selectedDate = new Date(RentACarInput.value);
        if (selectedDate < (currentDate.getTime()+(2*60*60*1000))) {
            alert("Araç kiralama işlemleri için şu anki saatten en az 2 saat sonrası seçilmelidir.");
            RentACarInput.value = twoHoursLater.toISOString().substring(0, 16);
        } else {
            const oneDayLater = new Date(selectedDate.getTime() + (27*60*60*1000));
            EndTimeInput.value = oneDayLater.toISOString().substring(0, 16);
            //Farkı bulalım
            const RentACarSelectedDate = new Date(RentACarInput.value);
            const diffTime = Math.abs(selectedDate - RentACarSelectedDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            document.getElementById("result").value = diffDays + " gün";
        }
    });

    EndTimeInput.addEventListener("change", function () {
        const selectedDate = new Date(EndTimeInput.value);
        const RentACarSelectedDate = new Date(RentACarInput.value);
        if (selectedDate < (RentACarSelectedDate.getTime()+(24*60*60*1000))) {
            alert("Araç kiralama işlemleri en az 1 gün olmaktadır. Teslim tarihini kontrol ediniz.");
            EndTimeInput.value = oneDayLater.toISOString().substring(0, 16);
        }
        //Farkı bulalım
        const diffTime = Math.abs(selectedDate - RentACarSelectedDate);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        document.getElementById("result").value = diffDays + " gün";
        document.getElementById("TotalPrice").value = diffDays * @Model.Car.Price;
    });
    

</script>
